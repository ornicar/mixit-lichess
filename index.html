<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>lichess.org - free online chess</title>

    <meta name="description" content="The world's chess community answer to commercial websites: yes, chess can be free!">
    <meta name="author" content="Thibault Duplessis">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/lichess.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <section>
            <img src="image/vintage-shirt.png" class="no-border" height="600px"/>
          </section>
          <section>
            <img src="image/wN.svg" class="no-border" width=200 />
            <h1>lichess.org</h1>
            <h4>an open source service</h4>
          </section>
          <aside class="notes">not *the* way to do things, just what worked for me</aside>
        </section>

        <section data-transition="fade">
          <h3>Hi, I'm Thibault Duplessis</h3>
          <br />
          <p>Software engineer at Zengularity*</p>
          <p>By day, I build prismic.io</p>
          <p>By night, I build lichess.org</p>
          <br />
          <br />
          <p class="shy">*Zengulary is quite awesome, by the way. You should be working there.</p>
        </section>

        <section>
          <section
            data-background="image/exception.png"
            data-state="full-page-img">
          </section>
          <section
            data-background="image/homepage.png"
            data-state="full-page-img">
          </section>
          <section
            data-background="image/menu.png"
            data-state="full-page-img">
          </section>
        </section>

        <section>
          <section>
            <h1>Numbers!</h1>
          </section>
          <section>
            <h3>634,000 unique visitors<br />per month</h3>
            <img src="image/analytics-users.png" />
            <p>Doubling every year</p>
            <aside class="notes">doubling every year</aside>
          </section>

          <section>
            <h3>Ranked <strong>12,586</strong> on Alexa</h3>
            <img src="image/alexa.png" />
            <h4><br />second most popular chess website</h4>
          </section>

          <section>
            <h3>MOAR NUMBERS</h3>
            <br>
            <table class="fat">
              <tbody>
                <tr>
                  <td class="tright">102</td>
                  <td>moves per second</td>
                </tr>
                <tr>
                  <td class="tright">180,000</td>
                  <td>games per day</td>
                </tr>
                <tr>
                  <td class="tright">67,000,000</td>
                  <td>games in the DB</td>
                </tr>
                <!-- <tr> -->
                  <!--   <td class="tright">3,400,000</td> -->
                  <!--   <td>computer analysed games <span class="shy">(100,000 CPU hours)</span></td> -->
                  <!-- </tr> -->
              </tbody>
            </table>
          </section>
        </section>

        <section>
          <section>
            <h3>Funds raised:</h3>
            <h1 class="green">$0.00</h1>
          </section>
          <section data-background="image/free.png">
          </section>

          <section data-background="image/crab.gif"
            data-state="full-page-img">
            <h1>OMG</h1>
            <h1>COMMUNISTS</h1>
          </section>
        </section>

        <section>
          <section>
            <h1>Why?</h1>
            <p>Yes, why not monetize that sh*t?</p>
          </section>
          <section>
            <h3>
              Software is like sex<br><br>it's better when it's free
              <aside class="notes">
                to keep things fun
                and just discard what is not fun
              </aside>
            </h3>
          </section>
        </section>

        <section>
          <section data-background="image/how.jpg">
            <h1>How?</h1>
          </section>
        </section>

        <section>
          <section>
            <img src="image/crappy-car.jpg" width="80%" />
            <h3>Technological domination</h3>
          </section>
          <section data-transition="fade">
            <h2>Fight tech debt</h2>
            <br>
            <p class="fragment">Refuse the hacks</p>
            <div class="fragment">
              <p>or</p>
              <p>Delete your code</p>
            </div>
            <aside class="notes">
              people code fast and don't take time to refactor
            </aside>
          </section>

          <section data-transition="fade">
            <h1>2010</h1>
            <h3>PHP 5.2<br>symfony 1<br>&nbsp;<br>MySQL<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h1>2010 ½</h1>
            <h3>PHP 5.3<br>symfony 1<br>Diem CMS<br>file tgz (!)<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h1>2011</h1>
            <h3>PHP 5.3<br>Symfony2<br>&nbsp;<br>MongoDB<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h1>2011 ½</h1>
            <h3>PHP 5.3<br>Symfony2<br>scala<br>MongoDB<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h1>2012</h1>
            <h3>scala<br>Play 2.0-Alpha<br>IO monad<br>MongoDB<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h1>2013</h1>
            <h3>scala<br>Play 2.x<br>concurrent.Future<br>MongoDB<br>jQuery</h3>
          </section>

          <section data-transition="fade">
            <h2>2014 - current</h2>
            <h3>scala<br>Play 2.x<br>concurrent.Future<br>MongoDB<br>virtual DOM (mithril.js)</h3>
          </section>

          <section>
            <img src="image/skel.jpg" class="fleft" width="37%"/>
            <h2>poor competition</h2>
            <h3>is lagging behind</h3>
            <p>stuck with aging codebases</p>
          </section>
        </section>

        <section>
          <section>
            <img src="image/scala-logo.png" class="no-border" />
          </section>
          <section>
            <h2>A modern language</h2>
            <pre><code data-trim class="scala">
package lila.game

case class Game(
  white: Player,
  black: Player,
  clock: Option[Clock])

val game = Game(carlsen, anand, None)
game.white // carlsen
            </code></pre>
          </section>
          <section>
            <h2>runs on JVM</h2>
            <ul>
              <li>Portable</li>
              <li>Compatible</li>
              <li>Safe</li>
              <li>Fast</li>
            </ul>
          </section>
          <section>
            <img src="image/lambda.png" class="no-border" height=100 />
            <br />
            <br />
            <h3>Functional programming</h3>
            <br />
            <p>as opposed to</p>
            <p>dysfunctional programming</p>
          </section>
          <section>
            <h2>Immutability</h2>
            <ul>
              <li>Expressive code</li>
              <li>Equational reasoning</li>
              <li>Control side effects</li>
              <li>Laugh at race conditions</li>
            </ul>
          </section>
          <section>
            <h2>strong static typing</h2>
            <ul>
              <li>Trust the types</li>
              <li>Refactor with confidence</li>
              <li>Write less tests</li>
              <li>Less runtime errors</li>
            </ul>
          </section>
          <section data-background="image/bacon.jpg">
            <h3>But with inference!</h3>
            <pre><code data-trim class="scala">
// Explicit typing
val isBaconBackgroundNecessary: Boolean = false

// Boolean type infered from the value
val isBaconBackgroundNecessary = false
            </code></pre>
          </section>

          <section>
            <p>Functional programming</p>
            <p>+</p>
            <p>Strong static typing</p>
            <p>=</p>
            <p>Code maintainability</p>
          </section>

          <section>
            <img src="image/sad-cookie.jpg" class="fleft" />
            <h2>poor competition</h2>
            <h3>is lagging behind</h3>
            <p>stuck with "dynamic",<br>dysfunctional languages</p>
          </section>
        </section>

        <section>
          <section data-background="image/mongodb-logo.png">
          </section>
          <section>
            <table class="fat">
              <h3>lichess on MongoDB 2.6</h3>
              <tbody>
                <tr>
                  <td class="tright">2k</td>
                  <td>queries per second</td>
                </tr>
                <tr>
                  <td class="tright">300</td>
                  <td>writes per second</td>
                </tr>
                <tr>
                  <td class="tright">124M</td>
                  <td>documents <span class="shy">(in 53 collections)</span></td>
                </tr>
                <tr>
                  <td class="tright">70GB</td>
                  <td>of <span class="shy">(compressed)</span> data</td>
                </tr>
                <tr>
                  <td class="tright">22GB</td>
                  <td>of indexes <span class="shy">(in RAM)</span></td>
                </tr>
              </tbody>
              <aside class="notes">Lots of transversal queries, need to load old games often</aside>
            </table>
          </section>
          <section>
            <h2>The good</h2>
            <ul>
              <li>Indexes</li>
              <li>Aggregation framework</li>
              <li>JavaScript data migrations</li>
              <li>Data is actually stored (not in /dev/null)</li>
            </ul>
          </section>
          <section>
            <h2>The less good</h2>
          </section>
          <section>
            <h3>No schema</h3>
            <p>No guaranty that data is well formed</p>
            <p>Better used with well typed language?</p>
          </section>
          <section>
            <h3>No "JOIN"</h3>
            <p>Queries operate on a single collection</p>
            <p>Relations are implemented on application side</p>
          </section>
          <section>
            <h3>Manual compression</h3>
            <pre><code data-trim class="json">
// one game
{
  "_id": "fuzvD3cZ",
  "c": BinData(0, "AwAAA3BFKSUAAAAA"),
  "ca": ISODate("2015-04-11T19:52:55.428Z"),
  "cl": BinData(0, "+GIAAVs="),
  "is": "LUCF3PDh",
  "mt": BinData(0, "SBQSeUZQ"),
  "pg": BinData(0, "GxwTc6BSgG2AQ0heQF5M3oQBIg=="),
  "ps": BinData(0, "MFAVQ2YABmYAQGAAAGYA0AAOAAAAAAwA7uzu7rAAnQs="),
  "ra": true,
  "s": 35,
  "so": 1,
  "t": 11,
  "ua": ISODate("2015-04-12T08:28:39.890Z"),
  "us": [
    "cabalchess",
    "senya9779"
  ],
  "wid": "cabalchess",
  "w": true,
  "tv": ISODate("2015-04-14T07:20:44.738Z")
}
</code></pre>
            <p>one game = 570 bytes</p>
            <aside class="notes">manual compression of all fields and un-indexed values</aside>
          </section>
          <section>
            <h3>MongoDB 3.0 fixes it</h3>
            <p>With the new WiredTiger storage</p>
          </section>
        </section>
        <section>
          <section>
            <h2>Infrastructure</h2>
            <p>How we host 180,000 games a day</p>
          </section>
          <section data-transition="fade">
            <h2>One server...</h2>
            <br>
            <img src="image/server-pic.png" class="fleft no-border" />
            <ul>
              <li>Intel Xeon E5-1620v2 4c/8t</li>
              <li>64 Go DDR3 ECC 1600MHz</li>
              <li>160 Go SSD</li>
              <li>1 Gbps</li>
              <li>$130 per month</li>
            </ul>
          </section>
          <section data-transition="fade">
            <h2>... does it all</h2>
            <br>
            <img src="image/server-pic.png" class="fleft no-border" />
            <ul class="check-list">
              <li>scala application</li>
              <li>MongoDB</li>
              <li>Elasticsearch</li>
              <li>nginx</li>
              <li>monitoring</li>
            </ul>
          </section>
          <section>
            <h3>Someone said redundancy?</h3>
            <br>
            <p>You're right, there isn't</p>
            <p>Keeping things simple and cheap</p>
            <p>Free service can fail</p>
            <p>It worked so far, Insha'Allah</p>
          </section>
          <section>
            <h3>Uptime this year</h3>
            <h1>99.92%</h1>
            <aside class="notes">not an impressive number. redundancy may reduce downtime, but so does simplicity</aside>
          </section>
        </section>
        <section>
          <section>
            <img src="image/hal.png" class="no-border" width="30%" />
            <h3>Distributing processing</h3>
            <h3>of artificial intelligence</h3>
          </section>
          <section>
            <h3>Chess A.I. are CPU hogs</h3>
            <p>Players want A.I. games and analysis</p>
            <aside class="notes">mention stockfish</aside>
          </section>
          <section>
            <h3>Community to the rescue!</h3>
            <p>8 servers donated to the A.I. cluster</p>
            <aside class="notes">mention WebEnabled, Zengularity, people servers and home computers</aside>
          </section>
          <section>
            <img src="image/ai-balancer.svg" height=400 class="diagram" />
          </section>
        </section>
        <section>
          <section>
            <h2>Keep it running</h2>
            <br>
            <p>understand why it fails</p>
          </section>
          <section data-background="image/monitor.jpg"
            data-state="contain-img">
          </section>
          <section>
            <h2>munin</h2>
            <div class="fragment">
              <p>Monitor JVM garbage collection</p>
              <img src="image/jvm-old.png" height=400 />
              <p>If old gen minimum goes up, you're screwed</p>
            </div>
          </section>
          <section>
            <h2>munin</h2>
            <p>Write custom plugins</p>
            <img src="image/mps.png" height=400 />
          </section>
          <section>
            <h2>health-check scripts</h2>
            <p>That wake you up at night</p>
            <pre><code data-trim class="javascript">
var addFail = function(v) {
  fail += v;
  if (fail >= failAlert) {
    sendSms('fail = ' + fail);
    fail = 0;
  }
};
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Keep it fast</h2>
          </section>
          <section>
            <h2>Backend speed</h2>
            <br>
            <pre><code>
root@lichess-main# siege en.lichess.org
** Preparing 15 concurrent users for battle.

Availability:                 100.00 %
Response time:                  0.00 secs
            </code></pre>
            <br>
            <p>Monitor it to spot perf regressions</p>
            <aside class="notes">you can hardly guess what will be slow while coding, only production will tell</aside>
          </section>
          <section>
            <h2>Frontend speed</h2>
            <img src="image/speed.jpg" width="1200" class="no-border" />
            <ul>
              <li>Make less requests</li>
              <li>Use a CDN</li>
              <li>Pick small JS libraries</li>
            </ul>
            <aside class="notes">keep nb requests low, use small JS libs, use cloudflare free CDN</aside>
          </section>
        </section>
      </section>

      <section>
        <section>
          <img src="image/mobile.png" class="no-border fleft" height=500 />
          <h2>Mobile App!</h2>
          <br>
          <p>Free, open source, no ads</p>
          <p>Community driven</p>
          <p>But native dev sucks...</p>
        </section>
        <section>
          <h2>Cordova + tarifa</h2>
          <br>
          <p>HTML / CSS / JS / virtual DOM</p>
          <p>Reuse website frontend code</p>
          <p>Build once, run on Android &amp; iOS</p>
          <br>
          <a href="https://github.com/veloce/lichobile">https://github.com/veloce/lichobile</a>
        </section>
      </section>

      <section>
        <section>
          <h1>Community</h1>
          <p>put dem users to work!</p>
          <aside class="notes">Great deal of fun. "Meet" awesome people. Magic of disinterestment and dedication</aside>
        </section>
      </section>
      <section>
        <section>
          <h2>Translations</h2>
          <img src="image/language.jpg" />
        </section>
        <section>
          <h2>Translations</h2>
          <img src="image/language2.jpg" />
          <aside class="notes">contexts written by community in a wiki</aside>
          <p>Provide contexts</p>
        </section>
        <section data-background="image/network.gif"
          data-state="full-page-img centered">
          <aside class="notes">
            14k contributions
            80 languages
            including 1337 and Latin
          </aside>
        </section>
      </section>
      <section>
        <section>
          <h2>Code contributions</h2>
          <br>
          <p>Open source service</p>
          <p>!=</p>
          <p>Open source library</p>
          <aside class="notes">You wake up at night when something's wrong</aside>
        </section>
        <section>
          <img src="image/jarjar.jpg" width="60%" />
          <h3>Filter contributors</h3>
          <p>Bad contributors have a negative impact</p>
        </section>
        <section>
          <h2>Good contributor</h2>
          <ol>
            <li>Experience</li>
            <li>Autonomy</li>
            <li>Involvment</li>
          </ol>
        </section>
        <section>
          <h3>Filter contributions</h3>
          <br>
          <p>Someone codes a nice feature</p>
          <p>-&gt; <strong>You</strong> get to maintain it</p>
        </section>
        <section>
          <h2>Bugfix &gt; Feature</h2>
          <p>Love people who get boring things done</p>
          <img src="image/miner.jpg" width="70%" />
          <aside class="notes">
            I love devs who accomplish boring tasks, it shows deep involvment
            People who just have fun coding a feature are unlikely to maintain it so I'm less impressed
          </aside>
        </section>
        <section>
          <h3>Pick a few promising talents</h3>
          <ul>
            <li>Teach them</li>
            <li>Give them motivating/fun features</li>
            <li>Let them scratch their itch</li>
          </ul>
        </section>
        <section>
          <h2>Watch out for</h2>
          <ul>
            <li>Perfs cost</li>
            <li>Complexity cost</li>
            <li>Assume only you get the big picture</li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h2>Design contributions</h2>
          <ul>
            <li>lots of crap</li>
            <li>people get emotional</li>
            <li>stick with few great contributors</li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h2>Common pitfalls</h2>
        </section>
        <section>
          <video src="image/strangelove.webm" width="80%" autoplay="" loop=""></video>
          <h3>Beware of talkers</h3>
          <p>They waste doers time</p>
        </section>
        <section>
          <h3>The stamp effect</h3>
          <br>
          <p>People want to impact the project</p>
          <p>Just because it looks like they can</p>
        </section>
        <section>
          <h3>"It was better before"</h3>
          <br>
          <p>Whatever you do</p>
          <p>Someone will hate it</p>
        </section>
      </section>
      <section>
        <section>
          <h3>Give up control</h3>
          <ul>
            <li>Distribute responsibilities</li>
            <li>Build up human shields</li>
            <li>Focus on what you do best</li>
          </ul>
        </section>
        <section>
          <img src="image/bus.jpg" width="80%"/>
          <h2>Bus factor</h2>
        </section>
        <section>
          <img src="image/dictator.png" width="50%" />
          <h3>The need for a dictator</h3>
          <ul>
            <li>Cut the crap</li>
            <li>Take unpopular decisions</li>
            <li>Prevent paralysis</li>
          </ul>
        </section>
      </section>
      <section>
        <section>
          <h2>Prepare to</h2>
          <h2>Deal with arseholes</h2>
          <video src="image/ned.webm" width="70%" autoplay="" loop=""></video>
        </section>
        <section>
          <h2>Trolls</h2>
          <p>Don't waste time</p>
          <p>Just shadow-ban</p>
          <p>(have mods do it)</p>
        </section>
        <section>
          <img src="image/ddos.jpg" width="40%" class="fleft" />
          <h2>DDoS attacks</h2>
          <br>
          <ul style="margin-left: 55%; display: block;">
            <li>Let the hosting company deal with it</li>
            <li>Tweak iptables and kernel network config</li>
          </ul>
        </section>
        <section>
          <h2>Applicative attacks</h2>
          <ul>
            <li>Yay, people actually read my code!</li>
            <li>Free security audit \o/</li>
            <li>Wake up at night D:</li>
          </ul>
        </section>
        <section>
          <h2>Cheating</h2>
          <h3>Attacks on the holy rating</h3>
          <aside class="notes">inevitable: computers are better than human</aside>
        </section>
        <section>
          <h2>Stupid cheats</h2>
          <p>Poor things copy-paste moves from an engine</p>
          <p>Automate the whole detection/ban process</p>
        </section>
        <section>
          <video src="image/factory.webm" width="60%" autoplay="" loop=""></video>
          <h2>Smart cheats</h2>
          <p>Automated cheating</p>
          <p>Coders looking for a challenge</p>
          <p>Can be reasoned with</p>
        </section>
        <section>
          <h2>Evil cheats</h2>
          <p>Like smart cheats</p>
          <p>but cannot be reasoned with</p>
        </section>
        <section>
          <h2>The double bot attack</h2>
        </section>
      </section>
      <section>
        <p>Open source service</p>
        <h2>It works</h2>
        <h3>and it's fun</h3>
      </section>
      <section>
        <img src="image/vintage-shirt.png" class="no-border" height="600px"/>
      </section>
    </div>

  </div>

  <script src="lib/js/head.min.js"></script>
  <script src="js/reveal.js"></script>

  <script>

    // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: false,
        progress: false,
        history: true,
        center: true,
        loop: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom
        transitionSpeed: 'fast',

        // Optional reveal.js plugins
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/notes/notes.js', async: true }
        ]
      });

  </script>

</body>
</html>
